<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/png" href="Logo.png">
    <title>Praxis · Maintenance</title>

    <style>
        :root {
            --bg: #0f1115;
            --panel: #151821;
            --text: #e5e7eb;
            --muted: #9ca3af;
            --border: #222633;
            --accent: #4f46e5;
        }

        * {
            box-sizing: border-box;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
                Roboto, Ubuntu, "Helvetica Neue", Arial, sans-serif;
        }

        body {
            margin: 0;
            height: 100vh;
            background: var(--bg);
            color: var(--text);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .container {
            width: 100%;
            max-width: 420px;
            padding: 24px;
        }

        .card {
            background: var(--panel);
            border: 1px solid var(--border);
            border-radius: 14px;
            padding: 32px 28px;
            text-align: center;
        }

        .logo {
            width: 64px;
            height: 64px;
            border-radius: 12px;
            background: linear-gradient(135deg, #4f46e5, #6366f1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 26px;
            margin: 0 auto 16px;
            color: #fff;
        }

        h1 {
            font-size: 20px;
            margin: 0 0 8px;
        }

        p {
            font-size: 14px;
            line-height: 1.6;
            color: var(--muted);
            margin: 0 0 20px;
        }

        .notice {
            background: rgba(79, 70, 229, 0.08);
            border: 1px solid rgba(79, 70, 229, 0.25);
            padding: 10px 12px;
            border-radius: 8px;
            font-size: 13px;
            color: #c7d2fe;
            margin-bottom: 22px;
        }

        form {
            display: flex;
            gap: 8px;
        }

        input[type="email"] {
            flex: 1;
            padding: 10px 12px;
            border-radius: 8px;
            border: 1px solid var(--border);
            background: #0b0d12;
            color: var(--text);
            font-size: 14px;
        }

        input::placeholder {
            color: #6b7280;
        }

        button {
            padding: 10px 14px;
            border-radius: 8px;
            border: none;
            background: var(--accent);
            color: white;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
        }

        button:hover {
            opacity: 0.9;
        }

        footer {
            margin-top: 18px;
            font-size: 12px;
            color: var(--muted);
        }

        /* New Styles for JS Form */
        .spinner {
            display: inline-block;
            width: 14px;
            height: 14px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
            margin-right: 8px;
            vertical-align: middle;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        button.loading {
            background: var(--muted);
            cursor: not-allowed;
        }

        .form-status {
            margin-top: 16px;
            padding: 10px;
            border-radius: 8px;
            font-size: 13px;
            display: none;
            text-align: center;
        }

        .form-status.success {
            background: rgba(39, 174, 96, 0.2);
            border: 1px solid #27ae60;
            color: #2ecc71;
        }

        .form-status.error {
            background: rgba(231, 76, 60, 0.2);
            border: 1px solid #e74c3c;
            color: #e74c3c;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="card">
            <!-- Replace "P" with logo image if you want -->
            <img src="Logo.png" alt="Praxis Logo" class="logo" style="background: none; padding: 0;">

            <h1>Praxis is under maintenance</h1>

            <p>
                We’re applying infrastructure updates and reliability fixes.
                The system will be back shortly.
            </p>

            <div class="notice">
                If you absolutely need access, leave your email.
                We’ll notify you the moment it’s live.
            </div>

            <form id="notifyForm">
                <!-- Honeypot Field -->
                <div style="opacity: 0; position: absolute; top: 0; left: 0; height: 0; width: 0; z-index: -1;">
                    <input type="text" name="website_check" id="website_check" tabindex="-1" autocomplete="off" />
                </div>
                <input type="email" id="email" name="email" placeholder="you@company.com" required />
                <button type="submit" id="submitButton">Notify me</button>
            </form>

            <div id="formStatus" class="form-status"></div>

        </div>
    </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const API_URL = "https://dharshan--smtp-portfolio--9hk6jmk926rf.code.run/api/contact/submit/";
            const MIN_LOADING_DURATION = 2000;
            const MIN_SUBMISSION_TIME = 2000; // 2 seconds
            const pageLoadTime = Date.now();

            const form = document.getElementById("notifyForm");
            const submitButton = document.getElementById("submitButton");
            const formStatus = document.getElementById("formStatus");

            if (form) {
                form.addEventListener("submit", async function (e) {
                    e.preventDefault();

                    // 1. Honeypot Spy Check
                    const honeyPot = document.getElementById("website_check");
                    if (honeyPot && honeyPot.value) {
                        // It's a bot! Fake a success.
                        showMessage("Your details have been queued.", "success");
                        form.reset();
                        return;
                    }

                    // 2. Time Trap Check
                    if (Date.now() - pageLoadTime < MIN_SUBMISSION_TIME) {
                        showMessage("Please fill out the form carefully.", "error");
                        return;
                    }

                    const startTime = Date.now();
                    setLoadingState(true);
                    resetStatus();

                    // Send email with dummy name/message to satisfy API expectation while focusing on email capture
                    const payload = {
                        name: "Praxis Maintenance Visitor",
                        email: document.getElementById("email").value.trim(),
                        message: "Please notify me when Praxis is back online."
                    };

                    try {
                        const response = await fetch(API_URL, {
                            method: "POST",
                            headers: {
                                "Content-Type": "application/json",
                            },
                            body: JSON.stringify(payload),
                        });

                        if (!response.ok) {
                            throw new Error("Server error");
                        }

                        const data = await response.json();
                        await ensureMinimumDelay(startTime);
                        showMessage("You'll be notified when we're back!", "success");
                        form.reset();
                        // Optionally disable future submissions?
                    } catch (error) {
                        console.error("Error:", error);
                        await ensureMinimumDelay(startTime);
                        showMessage("Could not register. Please try again later.", "error");
                    } finally {
                        setLoadingState(false);
                    }
                });
            }

            function resetStatus() {
                formStatus.className = "form-status";
                formStatus.style.display = "none";
            }

            function setLoadingState(isLoading) {
                if (isLoading) {
                    submitButton.classList.add("loading");
                    submitButton.innerHTML = '<span class="spinner"></span> Sending...';
                    submitButton.disabled = true;
                } else {
                    submitButton.classList.remove("loading");
                    submitButton.innerHTML = "Notify me";
                    submitButton.disabled = false;
                }
            }

            function showMessage(message, type) {
                formStatus.textContent = message;
                formStatus.className = "form-status " + type;
                formStatus.style.display = "block";

                if (type === "success") {
                    setTimeout(() => {
                        formStatus.style.display = "none";
                    }, 5000);
                }
            }

            function ensureMinimumDelay(startTime) {
                const elapsed = Date.now() - startTime;
                const remaining = MIN_LOADING_DURATION - elapsed;
                if (remaining > 0) {
                    return new Promise((resolve) => setTimeout(resolve, remaining));
                }
                return Promise.resolve();
            }
        });
    </script>
</body>

</html>